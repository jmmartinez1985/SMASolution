@{
    ViewBag.Title = "Home Page";
}


<!--=== Purchase Block ===-->
<div class="row-fluid purchase margin-bottom-30">
    <div class="container">
        <div class="span9">
            <span>Service Market servicios persona a persona.</span>
            <p>Aquí usted podrá buscar los servicios que necesite sin tener que hacer filas, llamadas innecesarias y sobre todo desde cualquier parte del mundo y en el horario que le sea más conveniente.</p>
        </div>
        <a href="#" class="btn-buy hover-effect">Conozca más</a>
    </div>
</div>
<!--/row-fluid-->
<!-- End Purchase Block -->

<div class="slider-inner">
    <div id="da-slider" class="da-slider">
        <div class="da-slide">
            <h2><i>CLEAN &amp; FRESH</i>
                <br />
                <i>FULLY RESPONSIVE</i>
                <br />
                <i>DESIGN</i></h2>
            <p>
                <i>Lorem ipsum dolor amet</i>
                <br />
                <i>tempor incididunt ut</i>
                <br />
                <i>veniam omnis </i>
            </p>
            <div class="da-img">
                <img src="@Url.Content("~/Images/1.png")" alt="" />
            </div>
        </div>
        <div class="da-slide">
            <h2><i>RESPONSIVE VIDEO</i>
                <br />
                <i>SUPPORT AND</i>
                <br />
                <i>MANY MORE</i></h2>
            <p>
                <i>Lorem ipsum dolor amet</i>
                <br />
                <i>tempor incididunt ut</i>
            </p>
            <div class="da-img span6">
                <div class="span6">
                    <iframe src="http://player.vimeo.com/video/47911018" width="100%" height="320" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
                </div>
            </div>
        </div>
        <div class="da-slide">
            <h2><i>USING BEST WEB</i>
                <br />
                <i>SOLUTIONS WITH</i>
                <br />
                <i>HTML5/CSS3</i></h2>
            <p>
                <i>Lorem ipsum dolor amet</i>
                <br />
                <i>tempor incididunt ut</i>
                <br />
                <i>veniam omnis </i>
            </p>
            <div class="da-img">
                <img src="@Url.Content("~/Images/html5andcss3.png")" alt="image01" />
            </div>
        </div>
        <nav class="da-arrows">
            <span class="da-arrows-prev"></span>
            <span class="da-arrows-next"></span>
        </nav>
    </div>
    <!--/da-slider-->
</div>

<br />



<div class="row-fluid purchase">
    <span>Búsqueda de Servicios</span>
    <div class="form-inline">
        <div class="input-append">
            <input id="txtSearchHome" class="input-xxlarge" type="text" placeholder="Buscar en la página">
            <button type="submit" class="btn-u btn-u-orange"><i class="icon-search icon-white"></i></button>
        </div>
        <a href="#advanced" role="button" data-toggle="modal" class="btn-u btn-u-orange btn-large">Búsqueda Avanzada</a>
    </div>

</div>



<br />

<div id="advanced" class="modal hide fade" tabindex="-1" data-refresh="false" role="dialog" aria-labelledby="advancedSort" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <ul class="nav nav-pills pull-right">
            <li class="active">
                <a href="#date" data-toggle="pill">Categorias</a>
            </li>
            <li><a href="#relevance" data-toggle="pill">Descripción</a></li>
            <li><a href="#dealership" data-toggle="pill">Ubicación</a></li>
        </ul>
        <h4>Busqueda Avanzada</h4>
    </div>
    <div class="modal-body">
        <div class="row-fluid">
            <div class="tab-content">
                <div class="tab-pane active" id="date">
                    <form>

                        <div class="controls controls-row">
                            @Html.DropDownList("CAT_Id", (IEnumerable<SelectListItem>)ViewBag.Categories, "Selecione la categoría", new { @class = "span6" })
                            @Html.DropDownList("SBS_Id", (IEnumerable<SelectListItem>)ViewBag.SubCategories, "Selecione la Subcategoría", new { @class = "span6" })

                        </div>
                        <input type="button" value="Buscar" onclick="CallFilter(1)" class="btn btn-warning" />

                    </form>
                </div>
                <div class="tab-pane" id="relevance">
                    <form>
                        <div class="controls controls-row">
                            <input type="text" id="descriptioninput" class="span12" placeholder="Descripcion, Palabras Clave, Otros">
                        </div>
                        <input type="button" value="Buscar" onclick="CallFilter(2)" class="btn btn-warning" />
                    </form>
                </div>
                <div class="tab-pane" id="dealership">
                    <form>

                        <div class="controls controls-row">
                            <input type="text" id="placeinput" class="span12" placeholder="Lugar, Ciudad , Ubicación">
                        </div>
                        <input type="button" value="Buscar" onclick="CallFilter(3)" class="btn btn-warning" />

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<!--Anuncios Table with pagination-->
<div style="width: 100%" id="firstSearch">
    <table class="table-hover">
        <thead>
        </thead>
        <tbody id="anunciosAvailable">
        </tbody>
        <tfoot>
            <tr>
                <td colspan="1">
                    <div class="holder" style="float: left">
                    </div>
                </td>
            </tr>
        </tfoot>

    </table>
</div>

<div style="width: 100%" id="SecondSearch">
    <table class="table-hover">
        <thead>
        </thead>
        <tbody id="SearchData">
        </tbody>
        <tfoot>
            <tr>
                <td colspan="1">
                    <div class="holder" style="float: left">
                    </div>
                </td>
            </tr>
        </tfoot>

    </table>
</div>


<div id="divNoAnunciosFound" class="bold large span12" style="padding: 5px; display: none;">
    No se obtuvieron resultados.
</div>

<script src="~/Scripts/raty-2.5.2/lib/jquery.raty.min.js"></script>
<link href="~/Content/Rating.css" rel="stylesheet" />
<!--/slider-->
<!--=== End Slider ===-->
<script type="text/javascript">
    jQuery(document).ready(function () {
        Index.initParallaxSlider();

        jQuery('#txtSearchHome').keyup(function () {
            var text = jQuery('#txtSearchHome').val();
            var rows = jQuery('#anunciosAvailable > tr');
            var isVisible = $('#firstSearch').is(':visible');
            if (!isVisible) {
                rows = jQuery('#SearchData > tr');
            }
            rows.each(function (idx, elem) {
                var rowText = $(elem).text().toLowerCase();
                if (rowText.indexOf(text.toLowerCase()) < 0) {
                    jQuery(elem).hide();
                }
                else {
                    jQuery(elem).show();
                }
            });
            setTimeout('CheckVisibleProjects();', 300);
        });

        jQuery("#CAT_Id").change(function () {
            $.ajax({
                dataType: "json",
                type: 'post',
                url: '@Url.Action("GetSubCategories", "SubCategoriaServicio")',
                data: { Cat: parseInt(jQuery("#CAT_Id").val()) },
                success: function (data) {
                    var result = JSON.parse(data);
                    var select = $('#SBS_Id');
                    if (select.prop) {
                        var options = select.prop('options');
                    }
                    else {
                        var options = select.attr('options');
                    }
                    $('option', select).remove();
                    $.each(result.$values, function (key, val) {
                        options[options.length] = new Option(val.SBS_Descripcion, val.SBS_Id);
                    });
                },
                error: function (a, b, c) {

                },
            });

        });

    });
    var $ki = jQuery.noConflict();
    $ki(function () {
        $ki.fn.raty.defaults.path = '@Url.Content("~/Scripts/raty-2.5.2/lib/img")';
    });



    $ki(function () {
        jQuery.ajax(
        {
            type: 'post',
            url: '@Url.Action("GetServices", "Home")',
            success: function (data) {
                var result = JSON.parse(data);
                var htmldata = '';
                jQuery('#firstSearch').show(300);
                jQuery('#SecondSearch').hide();
                jQuery.each(result.$values, function (val, anuncio) {
                    debugger;
                    htmldata += '<tr><td><div class="row-fluid">';
                    htmldata += '<div class="span12 booking-blocks"> '; 
                    htmldata += '<ul class="unstyled inline blog-info">';
                    htmldata += ' <li><i class="icon-calendar"></i>' + anuncio.AnunciosInfo.AN_Fecha + ' </li>';
                    htmldata += ' <li><i class="icon-comments"></i> <a href="#">'+ anuncio.Comments+ ' Reviews</a></li>';
                    htmldata += '</ul>';
                    htmldata += '<div class="pull-left booking-img">';
                    htmldata += '<img src=' + anuncio.FirstImage + ' alt=' + anuncio.Usuario + '> ';
                    htmldata += '<ul class="unstyled">';
                    htmldata += '<li><i class="icon-briefcase"></i>' + anuncio.CategoriaDescripcion + '</li> ';
                    htmldata += '<li><i class="icon-map-marker"></i>' + anuncio.AnunciosInfo.AN_Area + '</li>';
                    htmldata += '<li><ul class="unstyled inline"><li><div class="ratyclass" id=' + "toraty" + val + '  ratyval= ' + anuncio.Rating + ' style="width:20px;" ></div </li></ul></li>'
                    htmldata += '</ul>';
                    htmldata += '</div>';
                    htmldata += '<div style="overflow: hidden;">';
                    htmldata += '<h2><a href="#">' + anuncio.AnunciosInfo.AN_Titulo + '</a></h2> ';
                    htmldata += '<b>' + anuncio.Usuario + '</b>';
                    htmldata += '<p>' + anuncio.AnunciosInfo.AN_Descripcion + '</p>';
                    htmldata += '<button onclick="SeeAnuncios(' + anuncio.AnunciosInfo.AN_Id + ');"class="btn-u btn-u-orange">Leer Más</button>&nbsp;';
                    htmldata += '<button onclick="TakeService(' + anuncio.AnunciosInfo.AN_Id + ');" class="btn-u btn-u-orange">Solicitar</button>';
                    htmldata += '</div>';
                    htmldata += '</div>';
                    htmldata += '</div></td> </tr>';
                });
                jQuery('#anunciosAvailable').prepend(htmldata);
                jQuery('.ratyclass').each(function (i, elem) {
                    var ratyvalue = $(this).attr('ratyval');
                    $ki(this).raty({ readOnly: true, score: ratyvalue });
                });
                $ki("div.holder").jPages({
                    containerID: "anunciosAvailable",
                    //              previous: "←",
                    //              next: "→",
                    first: "Primera",
                    previous: "Anterior",
                    next: "Siguiente",
                    last: "Última",
                    perPage: 7,
                    delay: 20
                });
            },
            error: function (a, b, c) {
                alert('Here');
            }
        });
    });


    function FillFormData(search) {
        var form = new FormData();
        if (search == 1) {
            form.append("Categoria", jQuery('#CAT_Id').val());
            form.append("SubCategoria", jQuery('#SBS_Id').val());
            form.append("Lugar", "");
            form.append("Descripcion", "");
        }
        else if (search == 2) {
            form.append("Categoria", "");
            form.append("SubCategoria", "");
            form.append("Descripcion", jQuery('#descriptioninput').val());
            form.append("Lugar", "");
        }
        else {
            form.append("Categoria", "");
            form.append("SubCategoria", "");
            form.append("Descripcion", "");
            form.append("Lugar", jQuery('#placeinput').val());
        }

        return form;
    }

    function CallFilter(search) {
        var formdata = FillFormData(search)
        debugger;
        $.ajax({
            url: '@Url.Action("GetInformationAnuncios", "Anuncios")',
            type: 'post',
            data: formdata,
            cache: false,
            contentType: false,
            processData: false,
            beforeSend: function () {
                showProgress('../images/loading.gif');
            },
            complete: function (data) {
                hideProgress();
            },
            success: function (data) {
                if (data.Error) {
                    jQuery('#divNoAnunciosFound').fadeIn(1000);
                    jQuery('#SecondSearch').hide();
                    jQuery('#firstSearch').hide();
                    hideProgress();
                    jQuery('#advanced').modal('hide');
                    return true;
                }
                jQuery('#firstSearch').hide(300);
                jQuery('#SecondSearch').show();
                jQuery('#SearchData').html('');
                var result = JSON.parse(data);
                var htmldata = '';
                jQuery.each(result.$values, function (val, anuncio) {
                    htmldata += '<tr><td><div class="row-fluid">';
                    htmldata += '<div class="span12 booking-blocks"> ';
                    htmldata += '<div class="pull-left booking-img">';
                    htmldata += '<img src=' + anuncio.FirstImage + ' alt=' + anuncio.Usuario + '> ';
                    htmldata += '<ul class="unstyled">';
                    htmldata += '<li><i class="icon-briefcase"></i>' + anuncio.CategoriaDescripcion + '</li> ';
                    htmldata += '<li><i class="icon-map-marker"></i>' + anuncio.AnunciosInfo.AN_Area + '</li>';
                    htmldata += '<li><ul class="unstyled inline"><li><div class="ratyclass" id=' + "toraty" + val + '  ratyval= ' + anuncio.Rating + ' style="width:20px;" ></div </li></ul></li>'
                    htmldata += '</ul>';
                    htmldata += '</div>';
                    htmldata += '<div style="overflow: hidden;">';
                    htmldata += '<h2><a href="#">' + anuncio.AnunciosInfo.AN_Titulo + '</a></h2> ';
                    htmldata += '<b>' + anuncio.Usuario + '</b>';
                    htmldata += '<p>' + anuncio.AnunciosInfo.AN_Descripcion + '</p>';
                    htmldata += '<button onclick="SeeAnuncios(' + anuncio.AnunciosInfo.AN_Id + ');"class="btn-u btn-u-orange">Leer Más</button>&nbsp;';
                    htmldata += '<button onclick="TakeService(' + anuncio.AnunciosInfo.AN_Id + ');" class="btn-u btn-u-orange">Solicitar</button>';
                    htmldata += '</div>';
                    htmldata += '</div>';
                    htmldata += '</div></td> </tr>';
                });
                jQuery('#SearchData').prepend(htmldata);
                $ki("div.holder").jPages({
                    containerID: "SearchData",
                    //              previous: "←",
                    //              next: "→",
                    first: "Primera",
                    previous: "Anterior",
                    next: "Siguiente",
                    last: "Última",
                    perPage: 7,
                    delay: 20
                });
                jQuery('.ratyclass').each(function (i, elem) {
                    var ratyvalue = $(this).attr('ratyval');
                    $ki(this).raty({ readOnly: true, score: ratyvalue });
                });
                hideProgress();
                jQuery('#advanced').modal('hide');

            },
            error: function (xhr) {
                hideProgress();
            }
        });
    }

    function CheckVisibleProjects() {
        var rows = jQuery('#anunciosAvailable > tr');
        if (rows.filter(':hidden').size() == rows.length) {
            jQuery('#divNoAnunciosFound').fadeIn(1000);
        }
        else {
            jQuery('#divNoAnunciosFound').hide();
        }
    }

    function SeeAnuncios(anuncioid) {
        var url = '@Url.Action("Details", "Anuncios")' + "/" + anuncioid;
        window.location = url;
    }

    function TakeService(anuncioid) {
        var data = new FormData();
        data.append("Anuncio", anuncioid);
        $.ajax({
            url: '@Url.Action("TakeService", "SolicitudServicio")',
            type: 'post',
            data: data,
            cache: false,
            contentType: false,
            processData: false,
            beforeSend: function () {
                showProgress('../images/loading.gif');
            },
            complete: function (data) {
                hideProgress();
            },
            success: function (data) {
                $("#anunciosAvailable").prepend('<div class="alert alert-success fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>Servicio Solicitado!</strong> En breves horas el anunciante se debe contactar con usted para coordinar cita.</div>');
                $('.alert').alert();
                $('.alert').fadeOut(3000)
                //  alert('El servicio ha sido solicitado satisfactoriamente.', 'Solicitud de Servicio');
            },
            error: function (xhr) {
                if (xhr.status == 403) {
                    var response = $.parseJSON(xhr.responseText);
                    window.location = response.LogOnUrl;
                }
            }
        });

    }

    function showProgress(loadingImgSrc) {
        $ki.blockUI({
            message: '<p>Por favor espere mientra se procesa la solicitud...</p><img src="' + loadingImgSrc + '" /> <br>',
            css: {
                width: '450px',
                border: 'none',
                padding: '15px',
                backgroundColor: '#fafafa',
                'border-radius': '10px',
                opacity: .95,
                color: '#000',
                'font-size': '18px',
                'box-shadow': '0px 0px 12px rgba(0,0,0,.6)'
            }
        });
    }

    function hideProgress() {
        $ki.unblockUI();
    }
</script>
