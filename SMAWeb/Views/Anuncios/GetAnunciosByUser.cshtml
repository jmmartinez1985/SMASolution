@model IEnumerable<SMAWeb.Models.AnunciosViewModel>

@{
    ViewBag.Title = "Index";
}

<link href="@Url.Content("~/Content/jpages/jPages.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/jpages/animate.css")" rel="stylesheet" type="text/css" />
@*<link href="@Url.Content("~/Content/jpages/style.css")" rel="stylesheet" type="text/css" />*@
<script src="@Url.Content("~/Scripts/jpage/jPages.min.js")" type="text/javascript"></script>




<div class="container">
  @*  <div class="row-fluid purchase">
        <span>Búsqueda de Servicios</span>
        <div class="form-inline">
            <div class="input-append">
                <input id="txtSearchHome" class="input-xxlarge" type="text" placeholder="Buscar en la página">
                <button type="submit" class="btn-u btn-u-orange"><i class="icon-search icon-white"></i></button>
            </div>
            <a href="#advanced" role="button" data-toggle="modal" class="btn-u btn-u-orange btn-large">Búsqueda Avanzada</a>
        </div>

    </div>*@

    <br />
    <div class="row-fluid margin-bottom-10">

        <div class="another-page">
            <div class="headline">
                <h3>Mis Anuncios Publicados</h3>
            </div>

            <div style="width: 100%">
                <table class="table-hover">
                    <thead>
                    </thead>
                    <tbody id="anunciosAvailable">
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>
                                    <div class="row-fluid">
                                        <div class="span12 booking-blocks">
                                            <!--   -->
                                            <div class="pull-left booking-img">
                                                <!--   -->
                                                <img src="@item.FirstImage" alt="@item.Usuario">
                                                <!-- Nombre del Anunciante  -->
                                                <ul class="unstyled">
                                                    <li><i class="icon-briefcase"></i>@item.CategoriaDescripcion</li>
                                                    <!-- Categorias  -->
                                                    <li><i class="icon-map-marker"></i>@item.AnunciosInfo.AN_Area</li>
                                                    <!-- Lugar del anuncio, agregar campo a la base de datos  -->
                                                <li>
                                                    <ul class="unstyled inline">
                                                        <li><div class="ratyclass" id='@item.AnunciosInfo.AN_Id'  ratyval='@item.Rating' style="width:20px;" ></div </li>

                                                    </ul>

                                                </li>
                                                </ul>
                                            </div>
                                            <div style="overflow: hidden;">
                                                <h2><a href="@Url.Content("~/Anuncios/Details/" + @item.AnunciosInfo.AN_Id)">@item.AnunciosInfo.AN_Titulo</a></h2>
                                                <!-- Titulo Anuncio  -->

                                                <p>@item.AnunciosInfo.AN_Descripcion</p>
                                                <!-- Descripcion de anuncio, basado en 200 caracteres -->

                                                @Html.ActionLink("Preliminar", "Details", "Anuncios", new { id = item.AnunciosInfo.AN_Id }, new { @class = "btn-u btn-u-orange" })
                                                @Html.ActionLink("Editar", "Edit", "Anuncios", new { id = item.AnunciosInfo.AN_Id }, new { @class = "btn-u btn-u-orange" })

                                        
                                                <a class="btn-u btn-u-orange" onclick="DeleteAnuncio('@item.AnunciosInfo.AN_Id')" >Eliminar</a>
                                                <a class="btn-u btn-u-orange" onclick="InactivateAnuncio('@item.AnunciosInfo.AN_Id')" >Desactivar</a>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
           
                        }
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="1">
                                <div class="holder" style="float: left">
                                </div>
                            </td>
                        </tr>
                    </tfoot>

                </table>
            </div>
        </div>
    </div>


</div>



<div id="divNoAnunciosFound" class="bold large span12" style="padding: 5px; display: none;">
    No se obtuvieron resultados.
</div>

<script>



    var $jpage = jQuery.noConflict();
    $jpage(function () {
        $jpage("div.holder").jPages({
            containerID: "anunciosAvailable",
            //              previous: "←",
            //              next: "→",
            first: "Primera",
            previous: "Anterior",
            next: "Siguiente",
            last: "Última",
            perPage: 5,
            delay: 20
        });
    });


    jQuery('.ratyclass').each(function (i, elem) {
        var ratyvalue = jQuery(this).attr('ratyval');
        $ki(this).raty({ readOnly: true, score: ratyvalue });
        $ki(this).find('img').each(function () {
            var srcattr = $ki(this).attr('src');
            var completeimg = '@Url.Content("~/Scripts/raty-2.5.2/lib/img/")' + srcattr;
            $ki(this).attr('src', completeimg);
        });;
    });

    jQuery(document).ready(function () {

        jQuery('#txtSearchHome').keyup(function () {
            var text = jQuery('#txtSearchHome').val();
            var rows = jQuery('#anunciosAvailable > tr');

            rows.each(function (idx, elem) {
                var rowText = $(elem).text().toLowerCase();
                if (rowText.indexOf(text.toLowerCase()) < 0) {
                    jQuery(elem).hide();
                }
                else {
                    jQuery(elem).show();
                }
            });
            setTimeout('CheckVisibleProjects();', 300);
        });


    });
    function CheckVisibleProjects() {
        var rows = jQuery('#anunciosAvailable > tr');
        if (rows.filter(':hidden').size() == rows.length) {
            jQuery('#divNoAnunciosFound').fadeIn(1000);
        }
        else {
            jQuery('#divNoAnunciosFound').hide();
        }
    }

    function DeleteAnuncio(id) {
        jConfirm('Desea borrar el anuncio publicado?', 'Borrar anuncio existente', function (confirmed) {
            if (confirmed) {
                jQuery.ajax(
               {
                   type: 'post',
                   url: '@Url.Content("~/Anuncios/Delete/")',
                   data: { id: id },
                   beforeSend: function () {
                       showProgress('@Url.Content("~/images/loading.gif")');
                   },
                   complete: function (data) {
                       hideProgress();
                   },
                   success: function (data) {
                       debugger;
                       jAlert('Registro de anuncio borrado satistafactoriamente.');
                       window.location = data.redirectToUrl;

                   },
                   error: function (xhr) {
                       debugger;
                       if (xhr.status == 403) {

                       }
                       else {
                           jAlert(xhr.responseText, 'An error has ocurred');
                       }
                   }
               });
           }
        });
   }

   function InactivateAnuncio(id) {
       jConfirm('Desea desahilitar el anuncio publicado?', 'Desahilitar anuncio existente', function (confirmed) {
           if (confirmed) {
               jQuery.ajax(
              {
                  type: 'post',
                  url: '@Url.Content("~/Anuncios/Inactivate/")',
                  data: { id: id },
                  beforeSend: function () {
                      showProgress('@Url.Content("~/images/loading.gif")');
                  },
                  complete: function (data) {
                      hideProgress();
                  },
                  success: function (data) {
                      jAlert('Registro desahilitado satistafactoriamente.');
                      window.location = data.redirectToUrl;

                  },
                  error: function (xhr) {
                      debugger;
                      if (xhr.status == 403) {

                      }
                      else {
                          jAlert(xhr.responseText, 'An error has ocurred');
                      }
                  }
              });
          }
       });
  }


  var $ki = jQuery.noConflict();
  function showProgress(loadingImgSrc) {
      $ki.blockUI({
          message: '<p>Por favor espere mientra se procesa la solicitud...</p><img src="' + loadingImgSrc + '" /> <br>',
          css: {
              width: '450px',
              border: 'none',
              padding: '15px',
              backgroundColor: '#fafafa',
              'border-radius': '10px',
              opacity: .95,
              color: '#000',
              'font-size': '18px',
              'box-shadow': '0px 0px 12px rgba(0,0,0,.6)',
              'z-index': '9999'
          }
      });
  }

  function hideProgress() {
      $ki.unblockUI();
  }
</script>
