@model IEnumerable<SMAWeb.Models.AnunciosViewModel>

@{
    ViewBag.Title = "Mis Anuncios Publicados";
}


<link href="@Url.Content("~/Content/jpages/jPages.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/jpages/animate.css")" rel="stylesheet" type="text/css" />
@*<link href="@Url.Content("~/Content/jpages/style.css")" rel="stylesheet" type="text/css" />*@
<script src="@Url.Content("~/Scripts/jpage/jPages.min.js")" type="text/javascript"></script>



<br />
<div class="container">
    <div class="row-fluid margin-bottom-10">
        <div class="another-page">
            <div class="headline">
                <h3>Mis Anuncios Publicados</h3>
            </div>

            @if (Model.Count() > 0)
            {

                <div style="width: 100%">
                    <table class="table-hover" style="width: 100%">
                        <thead>
                        </thead>
                        <tbody id="anunciosAvailable">
                            @foreach (var item in Model)
                            {

                                <tr>
                                    <td>
                                        <div class="row-fluid">
                                            <div class="span12 booking-blocks">
                                                <!--   -->
                                                <div class="span10">
                                                    <div class="pull-left booking-img">
                                                        <!--   -->
                                                        <img src="@item.FirstImage" alt="@item.Usuario">
                                                        <!-- Nombre del Anunciante  -->
                                                        <ul class="unstyled">
                                                            <li>
                                                                <ul class="unstyled inline">
                                                                    <li>
                                                                        <div class="ratyclass" id='@item.AnunciosInfo.AN_Id'  ratyval='@item.Rating' style="width:20px;" ></div>
                                                                    </li>

                                                                </ul>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div style="overflow: hidden;">
                                                        <h2><a href="@Url.Content("~/Anuncios/Details/" + @item.AnunciosInfo.AN_Id)">@item.AnunciosInfo.AN_Titulo</a></h2>
                                                        <!-- Titulo Anuncio  -->
                                                        <ul class="unstyled inline">
                                                            <li><i class="icon-briefcase"></i>@item.CategoriaDescripcion</li>
                                                            <!-- Categorias  -->
                                                            <li><i class="icon-map-marker"></i>@item.AnunciosInfo.AN_Area</li>
                                                            <!-- Lugar del anuncio, agregar campo a la base de datos  -->
                                                        </ul>
                                                        <p>@item.AnunciosInfo.AN_Descripcion</p>
                                                        <!-- Descripcion de anuncio, basado en 200 caracteres -->


                                                    </div>
                                                </div>
                                                <div class="span2 pull-right">
                                                    <a class="btn-u btn-u-orange btn-block" href="@Url.Action("Details", "Anuncios")/@item.AnunciosInfo.AN_Id"><i class="icon-white icon-plus"></i>&nbsp;Leer Más</a>
                                                    <a class="btn-u btn-u-orange btn-block" href="@Url.Action("Edit", "Anuncios")/@item.AnunciosInfo.AN_Id"><i class="icon-white icon-edit"></i>&nbsp;Editar</a>


                                                    <a class="btn-u btn-u-orange btn-block" onclick="DeleteAnuncio('@item.AnunciosInfo.AN_Id', this)" ><i class="icon-white icon-trash"></i>&nbsp;Eliminar</a>
                                                    <a class="btn-u btn-u-orange btn-block" onclick="InactivateAnuncio('@item.AnunciosInfo.AN_Id' , this)" data-estado="@item.EstatusDescription"  ><i class="icon-white icon-refresh"></i>@if (@item.EstatusDescription == "Activo")
                                                                                                                                                                                                                                           { <i style="font-style: normal"><span>Desactivar</span></i>}
                                                                                                                                                                                                                                           else
                                                                                                                                                                                                                                           { <i style="font-style: normal"><span>Activar</span> </i>}</a>
                                                </div>

                                                <div class="span12">
                                                    <div class="fb-share-button" data-href="@Url.Action("Details", "Anuncios")/@item.AnunciosInfo.AN_Id" data-layout="button"></div>
                                                </div>

                                                <div class="span12">
                                                    <a href="https://twitter.com/share" class="twitter-share-button" data-url="@Url.Action("Details", "Anuncios")/@item.AnunciosInfo.AN_Id" data-text="Su portal de Búsqueda de Servicios en Línea" data-via="SMAWeb">Tweet</a>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
           
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="1">
                                    <div class="holder" style="float: left">
                                    </div>
                                </td>
                            </tr>
                        </tfoot>

                    </table>
                </div>
                
            }
            else
            {
                <div id="DivNoAnuncios" class="bold large span12" style="padding: 5px; display: block;">
                    <h4>No cuenta con anuncios publicados aún.</h4>
                    <br />
                </div>
                <h4>Le invitamos a crear sus <a class="color-green" href="@Url.Action("Create", "Anuncios")">&nbsp;anuncios gratuitos&nbsp;</a>en este su portal de servicios persona a persona.</h4>
                <h4>Service Market le ofrece:</h4>
                <ul class="unstyled">
                    <li><i class="icon-ok color-green"></i>Publicación de anuncios totalmente grátis</li>
                    <li><i class="icon-ok color-green"></i>Contratar los mejores servicios persona a persona</li>
                    <li><i class="icon-ok color-orange"></i>Comentarios después de cada servicio contratado</li>

                </ul>           }
        </div>
    </div>
</div>
<script>
    !function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');
</script>


<div id="divNoAnunciosFound" class="bold large span12" style="padding: 5px; display: none;">
    No se obtuvieron resultados.
</div>
<script src="~/Scripts/SMA.js"></script>
<script>



    var $jpage = jQuery.noConflict();
    $jpage(function () {
        $jpage("div.holder").jPages({
            containerID: "anunciosAvailable",
            //              previous: "←",
            //              next: "→",
            first: "Primera",
            previous: "Anterior",
            next: "Siguiente",
            last: "Última",
            perPage: 5,
            delay: 20
        });
    });


    jQuery('.ratyclass').each(function (i, elem) {
        var ratyvalue = jQuery(this).attr('ratyval');
        $ki(this).raty({ readOnly: true, score: ratyvalue });
        $ki(this).find('img').each(function () {
            var srcattr = $ki(this).attr('src');
            var completeimg = '@Url.Content("~/Scripts/raty-2.5.2/lib/img/")' + srcattr;
            $ki(this).attr('src', completeimg);
        });
    });

    jQuery(document).ready(function () {

        HOME.SearchKey();
        //jQuery('#txtSearchHome').keyup(function () {
        //    var text = jQuery('#txtSearchHome').val();
        //    var rows = jQuery('#anunciosAvailable > tr');

        //    rows.each(function (idx, elem) {
        //        var rowText = $(elem).text().toLowerCase();
        //        if (rowText.indexOf(text.toLowerCase()) < 0) {
        //            jQuery(elem).hide();
        //        }
        //        else {
        //            jQuery(elem).show();
        //        }
        //    });
        //    setTimeout('CheckVisibleProjects();', 300);
        //});


    });
    //function CheckVisibleProjects() {
    //    var rows = jQuery('#anunciosAvailable > tr');
    //    if (rows.filter(':hidden').size() == rows.length) {
    //        jQuery('#divNoAnunciosFound').fadeIn(1000);
    //    }
    //    else {
    //        jQuery('#divNoAnunciosFound').hide();
    //    }
    //}

    @*    function DeleteAnuncio(id) {

        bootbox.confirm("¿Desea eliminar el anuncio publicado?", "Cancelar", "Aceptar", function (result) {
            if (result) {
                debugger;
                jQuery.ajax(
               {
                   type: 'post',
                   url: '@Url.Content("~/Anuncios/Delete/")',
                   data: { id: id },
                   beforeSend: function () {
                       showProgress('@Url.Content("~/images/loading.gif")');
                   },
                   complete: function (data) {
                       hideProgress();
                   },
                   success: function (data) {
                       //jAlert('Registro borrado satistafactoriamente.');
                       //window.location = data.redirectToUrl;
                       location.reload();
                   },
                   error: function (xhr) {
                       debugger;
                       if (xhr.status == 403) {

                       }
                       else {
                           bootbox.alert("<h1>A ocurrido un error</h1> <br />" + xhr.responseText, function () {
                           });
                       }
                   }
               });
           }
        });

    }

    function InactivateAnuncio(id, estado) {
        var titulo;
        var mensaje;

        if (estado == 'Activo') {
            titulo = 'Cambiar el estado del anuncio';
            mensaje = '¿Desea desactivar el anuncio?';
        }
        else {
            titulo = 'Cambiar el estado del anuncio';
            mensaje = '¿Desea activar el anuncio?';
        }


        bootbox.confirm(mensaje, "Cancelar", "Aceptar", function (result) {
            if (result) {
                jQuery.ajax(
               {
                   type: 'post',
                   url: '@Url.Content("~/Anuncios/Inactivate/")',
                  data: { id: id },
                  beforeSend: function () {
                      showProgress('@Url.Content("~/images/loading.gif")');
                   },
                  complete: function (data) {
                      hideProgress();
                  },
                  success: function (data) {
                      //jAlert('Registro desahilitado satistafactoriamente.');
                      //window.location = data.redirectToUrl;
                      location.reload();

                  },
                  error: function (xhr) {
                      debugger;
                      if (xhr.status == 403) {

                      }
                      else {
                          bootbox.alert("<h1>A ocurrido un error</h1> <br />" + xhr.responseText, function () {
                          });
                      }
                  }
              });
           }
       });*@

        @*jConfirm(mensaje, titulo, function (confirmed) {
            if (confirmed) {
                jQuery.ajax(
               {
                   type: 'post',
                   url: '@Url.Content("~/Anuncios/Inactivate/")',
                   data: { id: id },
                   beforeSend: function () {
                       showProgress('@Url.Content("~/images/loading.gif")');
                   },
                   complete: function (data) {
                       hideProgress();
                   },
                   success: function (data) {
                       //jAlert('Registro desahilitado satistafactoriamente.');
                       //window.location = data.redirectToUrl;
                       location.reload();

                   },
                   error: function (xhr) {
                       debugger;
                       if (xhr.status == 403) {

                       }
                       else {
                           jAlert(xhr.responseText, 'An error has ocurred');
                       }
                   }
               });
            }
        });
   }*@

    function DeleteAnuncio(id, self) {
        ANUNCIOS.DeleteAnuncio(id, '@Url.Content("~/Anuncios/DeleteConfirmed/")', self);
    }

    function InactivateAnuncio(id, self) {
        ANUNCIOS.InactivateAnuncio(id, '@Url.Content("~/Anuncios/Inactivate/")', self);
    }

    //var $ki = jQuery.noConflict();
    //function showProgress(loadingImgSrc) {
    //    $ki.blockUI({
    //        message: '<p>Por favor espere mientra se procesa la solicitud...</p><img src="' + loadingImgSrc + '" /> <br>',
    //        css: {
    //            width: '450px',
    //            border: 'none',
    //            padding: '15px',
    //            backgroundColor: '#fafafa',
    //            'border-radius': '10px',
    //            opacity: .95,
    //            color: '#000',
    //            'font-size': '18px',
    //            'box-shadow': '0px 0px 12px rgba(0,0,0,.6)',
    //            'z-index': '9999'
    //        }
    //    });
    //}

    //function hideProgress() {
    //    $ki.unblockUI();
    //}
</script>
